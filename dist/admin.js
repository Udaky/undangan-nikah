(()=>{var r=(()=>{let s='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',i=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],f=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],u=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i},{name:"Samsung Browser",regex:/SamsungBrowser/i}],T=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_.]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i},{name:"Ubuntu",regex:/Ubuntu/i},{name:"Chrome OS",regex:/CrOS/i}],y=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),h=e=>{let t=l=>{window.alert(`${l} ${e}`)};return{success:()=>t("\u{1F7E9}"),error:()=>t("\u{1F7E5}"),warning:()=>t("\u{1F7E8}"),info:()=>t("\u{1F7E6}"),custom:l=>t(l)}},$=e=>window.confirm(`\u{1F7E6} ${e}`),b=(e,t)=>(e.replaceChildren(document.createRange().createContextualFragment(t)),e),I=(e,t,l=.05)=>new Promise(v=>{let k=parseFloat(e.style.opacity),S=t?1:0,B=()=>{k+=t?l:-l,k=Math.max(0,Math.min(1,k)),e.style.opacity=k.toFixed(2),t&&k>=S||!t&&k<=S?(e.style.opacity=S.toString(),v(e)):requestAnimationFrame(B)};requestAnimationFrame(B)}),w=(e,t=0)=>{let l=null;l=setTimeout(()=>{e(),clearTimeout(l),l=null},t)};return{loader:s,ask:$,copy:async(e,t=null,l=1500)=>{let v=e.getAttribute("data-copy");if(!v||v.length===0){h("Nothing to copy").warning();return}e.disabled=!0;try{await navigator.clipboard.writeText(v)}catch{e.disabled=!1,h("Failed to copy").error();return}let k=e.innerHTML;b(e,t||'<i class="fa-solid fa-check"></i>'),w(()=>{e.disabled=!1,e.innerHTML=k},l)},notify:h,timeOut:w,debounce:(e,t=100)=>{let l=null;return(...v)=>{clearTimeout(l),l=setTimeout(()=>e(...v),t)}},escapeHtml:y,base64Encode:e=>{let l=new TextEncoder().encode(e);return window.btoa(String.fromCharCode(...l))},base64Decode:e=>{let t=new TextDecoder,l=Uint8Array.from(window.atob(e),v=>v.charCodeAt(0));return t.decode(l)},disableButton:(e,t="Loading",l=!1)=>{e.disabled=!0;let v=e.innerHTML;return b(e,l?t:s+t),{restore:(k=!1)=>{e.innerHTML=v,e.disabled=k}}},disableCheckbox:e=>{e.disabled=!0;let t=document.querySelector(`label[for="${e.id}"]`),l=t.innerHTML;return b(t,s+l),{restore:()=>{t.innerHTML=l,e.disabled=!1}}},safeInnerHTML:b,parseUserAgent:e=>{if(!e||typeof e!="string")return"Unknown";let t=f.find(B=>B.regex.test(e))?.type??"Unknown",l=u.find(B=>B.regex.test(e))?.name??"Unknown",v=T.find(B=>B.regex.test(e)),k=v?v.name:"Unknown",S=v?e.match(v.regex)?.[1]?.replace(/_/g,".")??null:null;return`${l} ${t} ${S?`${k} ${S}`:k}`},changeOpacity:I,getGMTOffset:e=>{let t=new Date,l=new Intl.DateTimeFormat("en-US",{timeZone:e,hourCycle:"h23",hour:"numeric"}),v=(parseInt(l.format(t))-t.getUTCHours()+24)%24;return v>12&&(v-=24),`GMT${v>=0?"+":""}${v}`},convertMarkdownToHTML:e=>(i.forEach(([t,l])=>{e=e.replace(new RegExp(`\\${t}(\\S(?:[\\s\\S]*?\\S)?)\\${t}`,"g"),l)}),e)}})();var X={tab:f=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(f)),modal:f=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(f))};var q=(()=>{let s=({uuid:w,own:g,name:x,presence:A,comment:p,created_at:a,is_admin:m,is_parent:L,gif_url:o,ip:n,user_agent:e,comments:t,like_count:l})=>({uuid:w,own:g,name:x,presence:A,comment:p,created_at:a,is_admin:m??!1,is_parent:L,gif_url:o,ip:n,user_agent:e,comments:t?.map(s)??[],like_count:l??0}),i=w=>w.map(s);return{uuidResponse:({uuid:w})=>({uuid:w}),tokenResponse:({token:w})=>({token:w}),statusResponse:({status:w})=>({status:w}),getCommentResponse:s,getCommentsResponse:i,getCommentsResponseV2:w=>({count:w.count,lists:i(w.lists)}),commentShowMore:(w,g=!1)=>({uuid:w,show:g}),postCommentRequest:(w,g,x,A,p)=>({id:w,name:g,presence:x,comment:A,gif_id:p}),postSessionRequest:(w,g)=>({email:w,password:g}),updateCommentRequest:(w,g,x)=>({presence:w,comment:g,gif_id:x})}})();var R=s=>{let i=(h=null)=>{let $=JSON.parse(localStorage.getItem(s));return h?$[String(h)]:$},f=(h,$)=>{let b=i();b[String(h)]=$,localStorage.setItem(s,JSON.stringify(b))},u=h=>Object.keys(i()).includes(String(h)),T=h=>{if(!u(h))return;let $=i();delete $[String(h)],localStorage.setItem(s,JSON.stringify($))},y=()=>localStorage.setItem(s,"{}");return localStorage.getItem(s)||y(),{set:f,get:i,has:u,clear:y,unset:T}};var K="POST",G="PATCH",ue="DELETE";var te="AbortError",ye="TypeError",ne={Accept:"application/json","Content-Type":"application/json"},oe="request",Y=(()=>{let s=null;return{getInstance:i=>{if(!s||!s.has(i))throw new Error(`please init cache first: ${i}`);return s.get(i)},restart:async i=>{s.set(i,null),s.delete(i),await window.caches.delete(i),await window.caches.open(i).then(f=>s.set(i,f))},init:(i,f=[])=>{if(!window.isSecureContext)throw new Error("this application required secure context");s=new Map,Promise.all(f.concat([oe]).map(u=>window.caches.open(u).then(T=>s.set(u,T)))).then(()=>i())}}})(),le=s=>{let i=Y.getInstance(s);return{set:(y,h,$,b)=>h.clone().arrayBuffer().then(I=>{if(!h.ok)return h;let w=new Date,g=new Headers(h.headers);if(g.has("Date")||g.set("Date",w.toUTCString()),$||!g.has("Cache-Control")){if(!$&&g.has("Expires")){let x=new Date(g.get("Expires"));b=Math.max(0,x.getTime()-w.getTime())}if(b===0)throw new Error("Cache max age cannot be 0");g.set("Cache-Control",`public, max-age=${Math.floor(b/1e3)}`)}return g.has("Content-Length")||g.set("Content-Length",String(I.byteLength)),i.put(y,new Response(I,{headers:g})).then(()=>h)}),has:y=>i.match(y).then(h=>{if(!h)return null;let $=h.headers.get("Cache-Control").match(/max-age=(\d+)/)[1],b=Date.parse(h.headers.get("Date"))+parseInt($)*1e3;return Date.now()>b?null:h}),del:y=>i.delete(y)}},P=(s,i)=>{let f=new AbortController,u={signal:f.signal,credential:"include",headers:new Headers(ne),method:String(s).toUpperCase()},T=0,y=0,h=0,$=0,b=!1,I=!1,w=null,g=null,x=null,A=a=>{let m=()=>{let o=()=>window.fetch(a,u).then(async e=>{if(b)return f.abort(),new Response(null,{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)});if(!e.ok||!x)return e;let t=parseInt(e.headers.get("Content-Length")??0);if(t===0)return e;let l=[],v=0,k=e.body.getReader();for(;;){let{done:B,value:O}=await k.read();if(B)break;l.push(O),v+=O.length,await x(v,t,window.structuredClone?window.structuredClone(l):l)}let S=e.headers.get("Content-Type")??"application/octet-stream";return new Response(new Blob(l,{type:S}),{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)})});if(T===0||b)return o();if(u.method!=="GET")return console.warn("Only method GET can be cached"),o();let n=le(oe);return n.has(a).then(e=>e?Promise.resolve(e):n.del(a).then(o).then(t=>n.set(a,t,I,T)))};if(y===0||h===0)return m();let L=async()=>{try{return await m()}catch(o){if(o.name===te)throw o;if(h*=2,$++,$>y)throw new Error(`Max retries reached: ${o}`);return console.warn(`Retrying fetch (${$}/${y}): ${a.toString()}`),await new Promise(n=>window.setTimeout(n,h)),L()}};return L()},p=a=>{if(a.status!==200)return Promise.resolve(a);let m=document.querySelector("a[download]");m&&document.body.removeChild(m);let L=a.headers.get("Content-Disposition")?.match(/filename="(.+)"/)?.[1];return a.clone().blob().then(o=>{let n=document.createElement("a"),e=window.URL.createObjectURL(o);return n.href=e,n.download=L||`${g}.${w||(o.type.split("/")?.[1]??"bin")}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e),a})};return{send(a=null){return g&&Object.keys(ne).forEach(m=>u.headers.delete(m)),A(new URL(i,document.body.getAttribute("data-url"))).then(m=>g&&m.ok?p(m).then(L=>({code:L.status,data:L,error:null})):m.json().then(L=>{if(L.error){let o=L.error.at(0),n=m.status>=500;throw new Error(n?`ID: ${L.id}
\u{1F7E5} ${o}`:`\u{1F7E8} ${o}`)}return a&&(L.data=a(L.data)),Object.assign(L,{code:m.status})})).catch(m=>{if(m.name===te)return console.warn("Fetch aborted:",m),m;throw m.name===ye&&(m=new Error("\u{1F7E5} Network error or rate limit exceeded")),alert(m.message??String(m)),m})},withCache(a=1e3*60*60*6){return T=a,this},withForceCache(a=1e3*60*60*6){return I=!0,T===0&&(T=a),this},withNoBody(){return b=!0,this},withRetry(a=3,m=1e3){return y=a,h=m,this},withCancel(a){return a==null?this:((async()=>(await a,f.abort()))(),this)},withDownload(a,m=null){return g=a,w=m,this},withProgressFunc(a=null){return x=a,this},default(a=null){return u.headers=new Headers(a??{}),A(i).then(m=>g?p(m):Promise.resolve(m))},token(a){return a.split(".").length===3?(u.headers.append("Authorization","Bearer "+a),this):(u.headers.append("x-access-key",a),this)},body(a){if(u.method==="GET")throw new Error("GET method does not support body");return u.body=JSON.stringify(a),this}}};var C=(()=>{let s=null,i=()=>s.get("token"),f=w=>s.set("token",w),u=w=>P(K,"/api/session").body(w).send(q.tokenResponse).then(g=>(g.code===200&&f(g.data.token),g.code===200)),T=()=>s.unset("token"),y=()=>String(i()??".").split(".").length===3,h=w=>P("GET","/api/v2/config").withCache(1e3*60*30).withForceCache().token(w).send().then(g=>{if(g.code!==200)throw new Error("failed to get config.");let x=R("config");for(let[A,p]of Object.entries(g.data))x.set(A,p);return f(w),g}),$=()=>{if(!y())return null;try{return JSON.parse(r.base64Decode(i().split(".")[1]))}catch{return null}};return{init:()=>{s=R("session")},guest:h,isValid:()=>y()?($()?.exp??0)>Date.now()/1e3:!1,login:u,logout:T,decode:$,isAdmin:y,setToken:f,getToken:i}})();var Z=(()=>{let s=null,i=h=>{let $=r.disableButton(h),b=document.getElementById("loginEmail"),I=document.getElementById("loginPassword");b.disabled=!0,I.disabled=!0,C.login(q.postSessionRequest(b.value,I.value)).then(w=>{w&&(b.value=null,I.value=null,X.modal("mainModal").hide())}).finally(()=>{$.restore(),b.disabled=!1,I.disabled=!1})},f=async()=>{await Y.restart(oe),s.clear(),C.logout(),X.modal("mainModal").show()};return{init:()=>{s=R("user")},login:i,clearSession:f,getDetailUser:()=>P("GET","/api/user").token(C.getToken()).send().then(h=>{if(h.code!==200)throw new Error("failed to get user.");return Object.entries(h.data).forEach(([$,b])=>s.set($,b)),h}).catch(h=>(f(),h)),getUserStorage:()=>s}})();var me=(()=>{let s=(u,T)=>{document.querySelectorAll(".navbar button").forEach(y=>{y.classList.contains("active")&&y.classList.remove("active")}),X.tab(T).show(),u.classList.add("active")};return{buttonNavHome:u=>{s(u,"button-home")},buttonNavSetting:u=>{s(u,"button-setting")}}})();var se=(()=>{let s={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},i=["#ffffff","#f8f9fa"],f=["#000000","#212529"],u=!1,T=null,y=null,h=()=>T.set("active","light"),$=()=>T.set("active","dark"),b=m=>{let L=y.getAttribute("content");y.setAttribute("content",m.some(o=>o===L)?s[L]:L)},I=()=>{h(),document.documentElement.setAttribute("data-bs-theme","light"),b(f)},w=()=>{$(),document.documentElement.setAttribute("data-bs-theme","dark"),b(i)},g=(m=null,L=null)=>{let o=T.get("active")==="dark";return m&&L?o?m:L:o};return{init:()=>{switch(T=R("theme"),y=document.querySelector('meta[name="theme-color"]'),T.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?$():h()),document.documentElement.getAttribute("data-bs-theme")){case"dark":$();break;case"light":h();break;default:u=!0}g()?w():I()},spyTop:()=>{let m=o=>o.filter(n=>n.isIntersecting).forEach(n=>{let e=n.target.classList.contains("bg-white-black")?g(f[0],i[0]):g(f[1],i[1]);y.setAttribute("content",e)}),L=new IntersectionObserver(m,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(o=>L.observe(o))},change:()=>g()?I():w(),isDarkMode:g,isAutoMode:()=>u}})();var V=(()=>{let s={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},i=null,f=null,u=null,T=null;return{on(y,h){return T.set(y,h),this},get(){let y=T.get(u);return T.clear(),y},getCountry(){return i},getLocale(){return f},getLanguage(){return u},setDefault(y){let h=!0;s[y]||(h=!1,console.warn("Language not found, please add manually in countryMapping")),i=h?s[y]:"US",u=h?y:"en",f=`${u}_${i}`},init(){T=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var fe=(()=>{let s=null,i=!0,f=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],u=()=>i,T=()=>{let g=s.firstElementChild.firstElementChild;g.classList.remove("bg-success"),g.classList.add("bg-danger"),g.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},y=()=>{let g=s.firstElementChild.firstElementChild;g.classList.remove("bg-danger"),g.classList.add("bg-success"),g.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},h=async()=>{i&&(await r.changeOpacity(s,!1),T())},$=()=>{document.querySelectorAll(f.join(", ")).forEach(g=>{g.dispatchEvent(new Event(u()?"online":"offline")),g.setAttribute("data-offline-disabled",u()?"false":"true"),g.tagName==="BUTTON"?u()?g.classList.remove("disabled"):g.classList.add("disabled"):u()?g.removeAttribute("disabled"):g.setAttribute("disabled","true")})},b=()=>{i=!1,T(),r.changeOpacity(s,!0),$()},I=()=>{i=!0,y(),r.timeOut(h,3e3),$()};return{init:()=>{window.addEventListener("online",I),window.addEventListener("offline",b),s=document.createElement("div"),s.classList.add("fixed-top","pe-none"),s.style.cssText="opacity: 0; z-index: 1057;",s.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(s,document.body.lastChild)},isOnline:u}})();var ge=s=>{let i=new Map,f=new Map,u=le(s),T=1e3*60*60*6,y=!1,h=(x,A)=>{if(!A.ok)throw new Error(A.statusText);return u.set(x,A,y,T)},$=x=>u.has(x),b=x=>u.del(x),I=(x,A=null)=>{if(i.has(x))return Promise.resolve(i.get(x));if(f.has(x))return f.get(x);let p=()=>P("GET",x).withCancel(A).withRetry().default(),a=$(x).then(m=>m?Promise.resolve(m):b(x).then(p).then(L=>h(x,L))).then(m=>m.blob()).then(m=>i.set(x,URL.createObjectURL(m))).then(()=>i.get(x)).finally(()=>f.delete(x));return f.set(x,a),a};return{run:(x,A=null)=>{let p=new Map;return x.length===0?Promise.resolve():(x.filter(a=>a!==null).forEach(a=>{let m=p.get(a.url)??[];p.set(a.url,[...m,[a.res,a?.rej]])}),Promise.allSettled(Array.from(p).map(([a,m])=>I(a,A).then(L=>(m.forEach(o=>o[0]?.(L)),L)).catch(L=>(m.forEach(o=>o[1]?.(L)),L)))))},del:b,has:$,set:h,get:I,open,download:async(x,A)=>{if(!new Map(Array.from(i.entries()).map(([a,m])=>[m,a])).has(x))try{if(!new URL(x).protocol.includes("blob"))throw new Error("Is not blob")}catch{x=await I(x)}return P("GET",x).withDownload(A).default()},setTtl(x){return T=Number(x),this},withForceCache(){return y=!0,this}}};var _=(()=>{let s="default",i={128:2,256:3,512:4,768:5},f=null,u=null,T=null,y=null,h=(d,c,E=null)=>{let H=u.get(d);return c.map(D=>{let{id:N,media_formats:{tinygif:{url:z}},content_description:M}=D;H.pointer===-1||H.pointer===H.col-1?H.pointer=0:H.pointer++;let ee=H.lists.childNodes[H.pointer]??null;return ee?{url:z,res:ie=>{ee.insertAdjacentHTML("beforeend",`
                <figure class="hover-wrapper m-0 position-relative">
                    <button onclick="undangan.comment.gif.click(this, '${H.uuid}', '${N}', '${r.base64Encode(z)}')" class="btn hover-area position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <img src="${ie}" class="img-fluid" alt="${r.escapeHtml(M)}" style="width: 100%;">
                </figure>`),E?.step()}}:null})},$=d=>f.get(d),b=d=>{let c=u.get(d),E=c.lists,H=document.getElementById(`gif-loading-${c.uuid}`),D=document.getElementById(`progress-bar-${c.uuid}`),N=document.getElementById(`progress-info-${c.uuid}`),z=0,M=0;E.setAttribute("data-continue","false"),E.classList.replace("overflow-y-scroll","overflow-y-hidden");let ee=150,re=!1,ie=setTimeout(()=>{re||(N.innerText=`${M}/${z}`,E.classList.contains("d-none")||H.classList.replace("d-none","d-flex"))},ee);return{release:()=>{re=!0,clearTimeout(ie),E.classList.contains("d-none")||H.classList.replace("d-flex","d-none"),D.style.width="0%",N.innerText=`${M}/${z}`,E.setAttribute("data-continue","true"),E.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:be=>{z=be,N.innerText=`${M}/${z}`},step:()=>{M+=1,N.innerText=`${M}/${z}`,D.style.width=Math.min(M/z*100,100).toString()+"%"}}},I=(d,c,E)=>{E={media_filter:"tinygif",client_key:"undangan_app",key:y.get("tenor_key"),country:V.getCountry(),locale:V.getLocale(),...E??{}};let H=Object.keys(E).filter(M=>E[M]!==null&&E[M]!==void 0).map(M=>`${M}=${encodeURIComponent(E[M])}`).join("&"),D=b(d),N=u.get(d),z=new Promise(M=>{N.reqs.push(M)});N.last=P("GET",`https://tenor.googleapis.com/v2${c}?${H}`).withCache().withRetry().withCancel(z).default(ne).then(M=>M.json()).then(M=>{if(M.error)throw new Error(M.error.message);return M.results.length===0?M:(N.next=M?.next,D.until(M.results.length),N.gifs.push(...M.results),f.run(h(d,M.results,D),z))}).catch(M=>{M.name===te?console.warn("Fetch abort:",M):r.notify(M).error()}).finally(()=>D.release())},w=d=>(d=r.escapeHtml(d),`
        <label for="gif-search-${d}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${d}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${d}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input dir="auto" type="text" name="gif-search" id="gif-search-${d}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${d}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${d}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${d}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${d}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${d}">
            <button onclick="undangan.comment.gif.cancel('${d}')" id="gif-cancel-${d}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-0 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),g=async d=>{let c=u.get(d);c.reqs.forEach(E=>E()),c.reqs.length=0,c.last&&(await c.last,c.last=null)},x=async d=>{await g(d);let c=u.get(d),E=c.col??0,H=0;for(let[D,N]of Object.entries(i))H=N,c.lists.clientWidth>=parseInt(D)&&(c.col=H);if(c.col===null&&(c.col=H),E!==c.col&&(c.pointer=-1,c.limit=c.col*5,c.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(c.col),c.gifs.length!==0)){try{await f.run(h(d,c.gifs))}catch{c.gifs.length=0}E!==c.col&&c.lists.scroll({top:c.lists.scrollHeight,behavior:"instant"}),c.gifs.length===0&&await x(d)}},A=async d=>{let c=u.get(d);if(c.lists.getAttribute("data-continue")!=="true"||!c.next||c.next.length===0)return;let E=c.query&&c.query.trim().length>0,H={pos:c.next,limit:c.limit};E&&(H.q=c.query),c.lists.scrollTop>(c.lists.scrollHeight-c.lists.clientHeight)*.8&&(await x(d),I(d,E?"/search":"/featured",H))},p=async(d,c=null)=>{let E=u.get(d);E.query=c!==null?c:E.query,(!E.query||E.query.trim().length===0)&&(E.query=null),E.col=null,E.next=null,E.pointer=-1,E.gifs.length=0,await x(d),I(d,E.query===null?"/featured":"/search",{q:E.query,limit:E.limit})},a=async(d,c,E,H)=>{let D=r.disableButton(d,r.loader.replace("me-1","me-0"),!0),N=document.getElementById(`gif-result-${c}`);N.setAttribute("data-id",E),N.querySelector(`#gif-cancel-${c}`).classList.replace("d-none","d-flex"),N.insertAdjacentHTML("beforeend",`<img src="${await $(r.base64Decode(H))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),D.restore(),u.get(c).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${c}`).classList.replace("d-flex","d-none")},m=d=>{let c=document.getElementById(`gif-result-${d}`);c.removeAttribute("data-id"),c.querySelector(`#gif-cancel-${d}`).classList.replace("d-flex","d-none"),c.querySelector("img").remove(),u.get(d).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${d}`).classList.replace("d-none","d-flex")},L=async(d=null)=>{d?u.has(d)&&(await g(d),T.delete(d),u.delete(d)):(await Promise.allSettled(Array.from(u.keys()).map(c=>g(c))),T.clear(),u.clear())},o=async(d,c)=>{let E=r.disableButton(d,r.loader.replace("me-1","me-0"),!0);await g(c),E.restore(),document.getElementById(`gif-form-${c}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${c}`)?.classList.toggle("d-none",!1)},n=d=>{if(!u.has(d)){r.safeInnerHTML(document.getElementById(`gif-form-${d}`),w(d));let c=document.getElementById(`gif-lists-${d}`);u.set(d,{uuid:d,lists:c,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let E=r.debounce(A,150);c.addEventListener("scroll",()=>E(d));let H=r.debounce(p,850);document.getElementById(`gif-search-${d}`).addEventListener("input",D=>H(d,D.target.value))}return document.getElementById(`gif-form-${d}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${d}`)?.classList.toggle("d-none",!0),T.has(d)&&T.get(d)(),p(d)},e=d=>{let c=document.getElementById(`gif-form-${d}`);return c&&!c.classList.contains("d-none")},t=d=>document.getElementById(`gif-result-${d}`)?.getAttribute("data-id"),l=d=>document.querySelector(`[for="gif-search-${d}"]`)?.remove(),v=d=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${d}')"]`)?.remove(),k=(d,c)=>T.set(d,c),S=(d=null)=>{let c=document.getElementById(`gif-cancel-${d||s}`);return{show:()=>c.classList.replace("d-none","d-flex"),hide:()=>c.classList.replace("d-flex","d-none"),click:()=>c.dispatchEvent(new Event("click"))}},B=()=>!!y.get("tenor_key"),O=()=>{document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.classList.toggle("d-none",!y.get("tenor_key"))};return{default:s,init:()=>{f=ge("gif"),u=new Map,T=new Map,y=R("config"),document.addEventListener("undangan.session",O)},get:$,back:o,open:n,cancel:m,click:a,remove:L,isOpen:e,onOpen:k,isActive:B,getResultId:t,buttonCancel:S,removeGifSearch:l,removeButtonBack:v}})();var F=(()=>{let s=null,i=null,f=null,u=null,T=300,y=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,h=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like_count}">${e.like_count}</span>
            <i class="me-1 ${i.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,$=e=>{let t=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return f.get("can_reply")!==!1&&(t+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply('${e.uuid}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),C.isAdmin()&&e.is_admin&&(!e.gif_url||_.isActive())?t+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Edit</button>`:s.has(e.uuid)&&f.get("can_edit")!==!1&&(!e.gif_url||_.isActive())&&(t+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),C.isAdmin()?t+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:s.has(e.uuid)&&f.get("can_delete")!==!1&&(t+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),t+="</div>",t},b=(e,t)=>{e=r.escapeHtml(e);let l=u.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${r.escapeHtml(t.join(","))}" data-show="${l?"true":"false"}" role="button" class="me-auto ms-1 py-0">${l?"Hide replies":`Show replies (${t.length})`}</a>`},I=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${$(e)}
            ${e.comments.length>0?b(e.uuid,e.comments.map(t=>t.uuid)):""}
            ${h(e)}
        </div>`,w=e=>!e.ip||!e.user_agent||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${r.escapeHtml(e.ip)} <span class="mb-1 placeholder col-2 rounded-3"></span></p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${r.parseUserAgent(r.escapeHtml(e.user_agent))}</p>
        </div>`,g=e=>e.is_parent?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4"':`class="${u.get("hidden").find(t=>t.uuid===e.uuid).show?"":"d-none"} overflow-x-auto mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,x=e=>e.is_admin?`<strong class="me-1">${r.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:e.is_parent?`<strong class="me-1">${r.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${r.escapeHtml(e.name)}</strong>`,A=async e=>{let t=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${x(e)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return t+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await _.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let l=e.comment.length>T,v=r.convertMarkdownToHTML(r.escapeHtml(l?e.comment.slice(0,T)+"...":e.comment));return t+`
        <p dir="auto" class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" data-comment="${r.base64Encode(e.comment)}" id="content-${e.uuid}">${v}</p>
        ${l?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},p=async e=>{let t=await A(e),l=await Promise.all(e.comments.map(v=>p(v)));return`
        <div ${g(e)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${t}</div>
            ${w(e)}
            ${I(e)}
            <div id="reply-content-${e.uuid}">${l.join("")}</div>
        </div>`};return{init:()=>{s=R("owns"),i=R("likes"),f=R("config"),u=R("comment")},renderEdit:(e,t,l,v)=>{e=r.escapeHtml(e);let k=document.createElement("div");k.classList.add("my-2"),k.id=`inner-${e}`;let S=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${l?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${t?"selected":""}>&#9989; Datang</option>
            <option value="2" ${t?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${v?`${_.isActive()?`<div class="d-none mb-2" id="gif-form-${e}"></div>`:""}`:`<textarea dir="auto" class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return r.safeInnerHTML(k,S)},renderReply:e=>{e=r.escapeHtml(e);let t=document.createElement("div");t.classList.add("my-2"),t.id=`inner-${e}`;let l=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${_.isActive()?`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`:""}
                <textarea dir="auto" class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return r.safeInnerHTML(t,l)},renderLoading:y,renderReadMore:b,renderContentMany:e=>Promise.all(e.map(t=>p(t))).then(t=>t.join("")),renderContentSingle:e=>p(e),maxCommentLength:T}})();var we=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var pe=(s,i=50)=>{if(!window.confetti)return;let f=Date.now()+i,u=s.getBoundingClientRect(),T=Math.max(.3,Math.min(1,u.top/window.innerHeight+.2)),y=we(),h=["#FF69B4","#FF1493"],$=()=>{h.forEach(b=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[y],origin:{x:u.left/window.innerWidth,y:T},zIndex:1057,colors:[b]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[y],origin:{x:u.right/window.innerWidth,y:T},zIndex:1057,colors:[b]})}),Date.now()<f&&requestAnimationFrame($)};requestAnimationFrame($)};var W=(()=>{let s=null,i=null,f=async b=>{let I=b.firstElementChild,w=b.lastElementChild,g=b.getAttribute("data-uuid"),x=parseInt(I.getAttribute("data-count-like"));b.disabled=!0,navigator.vibrate&&navigator.vibrate(100),s.has(g)?await P(G,"/api/comment/"+s.get(g)).token(C.getToken()).send(q.statusResponse).then(A=>{A.data.status&&(s.unset(g),w.classList.remove("fa-solid","text-danger"),w.classList.add("fa-regular"),I.setAttribute("data-count-like",String(x-1)))}).finally(()=>{I.innerText=I.getAttribute("data-count-like"),b.disabled=!1}):await P(K,"/api/comment/"+g).token(C.getToken()).send(q.uuidResponse).then(A=>{A.code===201&&(s.set(g,A.data.uuid),w.classList.remove("fa-regular"),w.classList.add("fa-solid","text-danger"),I.setAttribute("data-count-like",String(x+1)))}).finally(()=>{I.innerText=I.getAttribute("data-count-like"),b.disabled=!1})},u=b=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${b}"]`),T=async b=>{if(!navigator.onLine)return;let I=Date.now(),w=I-parseInt(b.getAttribute("data-tapTime")),g=b.id.replace("body-content-",""),x=w<300&&w>0,A=!s.has(g)&&b.getAttribute("data-liked")!=="true";x&&A&&(pe(b),b.setAttribute("data-liked","true"),await f(u(g)),b.setAttribute("data-liked","false")),b.setAttribute("data-tapTime",String(I))};return{init:()=>{i=new Map,s=R("likes")},love:f,getButtonLike:u,addListener:b=>{let I=new AbortController,w=document.getElementById(`body-content-${b}`);w.addEventListener("touchend",()=>T(w),{signal:I.signal}),i.set(b,I)},removeListener:b=>{let I=i.get(b);I&&(I.abort(),i.delete(b))}}})();var j=(()=>{let s=10,i=0,f=0,u=null,T=null,y=null,h=null,$=null,b=e=>{s=Number(e)},I=()=>s,w=()=>i,g=()=>f,x=()=>T.classList.contains("disabled")?null:T.classList.add("disabled"),A=()=>T.classList.contains("disabled")?T.classList.remove("disabled"):null,p=()=>y.classList.contains("disabled")?null:y.classList.add("disabled"),a=()=>y.classList.contains("disabled")?y.classList.remove("disabled"):null,m=e=>{p(),x();let t=r.disableButton(e,r.loader.replace("ms-0 me-1","mx-1"),!0),l=()=>{$.addEventListener("undangan.comment.done",()=>t.restore(),{once:!0}),$.addEventListener("undangan.comment.result",()=>$.scrollIntoView(),{once:!0}),$.dispatchEvent(new Event("undangan.comment.show"))};return{next:()=>{i+=s,e.innerHTML="Next"+e.innerHTML,l()},prev:()=>{i-=s,e.innerHTML=e.innerHTML+"Prev",l()}}};return{init:()=>{h=document.getElementById("pagination"),h.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,$=document.getElementById("comments"),u=document.getElementById("page"),T=document.getElementById("previous"),y=document.getElementById("next")},setPer:b,getPer:I,getNext:w,reset:()=>i===0?!1:(i=0,p(),x(),!0),setTotal:e=>{if(f=Number(e),f<=s&&i===0){h.classList.add("d-none");return}let t=i/s+1,l=Math.ceil(f/s);if(u.innerText=`${t} / ${l}`,i>0&&A(),t>=l){p();return}a(),h.classList.contains("d-none")&&h.classList.remove("d-none")},geTotal:g,previous:e=>m(e).prev(),next:e=>m(e).next()}})();var ae=(()=>{let s=null,i=null,f=null,u=[],T=(o,n)=>{document.querySelector(`[data-button-action="${o}"]`).childNodes.forEach(e=>{e.disabled=n})},y=o=>{T(o,!1),document.getElementById(`inner-${o}`).remove()},h=o=>{let n=o.getAttribute("data-uuids").split(","),e=o.getAttribute("data-show")==="true",t=o.getAttribute("data-uuid"),l=i.get("show");o.setAttribute("data-show",e?"false":"true"),o.innerText=e?`Show replies (${n.length})`:"Hide replies",i.set("show",e?l.filter(v=>v!==t):[...l,t]);for(let v of n)i.set("hidden",i.get("hidden").map(k=>(k.uuid===v&&(k.show=!e),k))),document.getElementById(v).classList.toggle("d-none",e)},$=(o,n)=>{let e=document.getElementById(`content-${n}`),t=r.base64Decode(e.getAttribute("data-comment")),l=o.getAttribute("data-show")==="false";r.safeInnerHTML(e,r.convertMarkdownToHTML(r.escapeHtml(l?t:t.slice(0,F.maxCommentLength)+"..."))),o.innerText=l?"Sebagian":"Selengkapnya",o.setAttribute("data-show",l?"true":"false")},b=async o=>{if(o.comments&&await Promise.all(o.comments.map(e=>b(e))),!o.ip||!o.user_agent||o.is_admin)return;let n=e=>{let t=document.getElementById(`ip-${r.escapeHtml(o.uuid)}`);r.safeInnerHTML(t,`<i class="fa-solid fa-location-dot me-1"></i>${r.escapeHtml(o.ip)} <strong>${r.escapeHtml(e)}</strong>`)};await P("GET",`https://apip.cc/api-json/${o.ip}`).withCache().withRetry().default().then(e=>e.json()).then(e=>{let t="localhost";e.status==="success"&&(e.City.length!==0&&e.RegionName.length!==0?t=e.City+" - "+e.RegionName:e.Capital.length!==0&&e.CountryName.length!==0&&(t=e.Capital+" - "+e.CountryName)),n(t)}).catch(e=>n(e.message))},I=(o,n=[])=>{let e=i.get("show"),t=v=>v.forEach(k=>{if(n.find(S=>S.uuid===k.uuid)){t(k.comments);return}n.push(q.commentShowMore(k.uuid)),t(k.comments)}),l=v=>v.forEach(k=>{if(!e.includes(k.uuid)){l(k.comments);return}k.comments.forEach(S=>{let B=n.findIndex(O=>O.uuid===S.uuid);B!==-1&&(n[B].show=!0)}),l(k.comments)});return t(o),l(o),n},w=()=>(u.forEach(o=>{W.removeListener(o)}),f.getAttribute("data-loading")==="false"&&(f.setAttribute("data-loading","true"),f.innerHTML=F.renderLoading().repeat(j.getPer())),P("GET",`/api/v2/comment?per=${j.getPer()}&next=${j.getNext()}&lang=${V.getLanguage()}`).token(C.getToken()).withCache(1e3*30).withForceCache().send(q.getCommentsResponseV2).then(async o=>{f.setAttribute("data-loading","false");for(let t of u)await _.remove(t);if(o.data.lists.length===0)return f.innerHTML="",o;let n=t=>t.flatMap(l=>[l.uuid,...n(l.comments)]);u.splice(0,u.length,...n(o.data.lists)),i.set("hidden",I(o.data.lists,i.get("hidden")));let e=await F.renderContentMany(o.data.lists);return o.data.lists.length<j.getPer()&&(e+=""),r.safeInnerHTML(f,e),u.forEach(t=>{W.addListener(t)}),o}).then(async o=>(f.dispatchEvent(new Event("undangan.comment.result")),o.data.lists&&C.isAdmin()&&await Promise.all(o.data.lists.map(n=>b(n))),j.setTotal(o.data.count),f.dispatchEvent(new Event("undangan.comment.done")),o)));return{gif:_,like:W,pagination:j,init:()=>{_.init(),W.init(),F.init(),j.init(),f=document.getElementById("comments"),f.addEventListener("undangan.comment.show",w),s=R("owns"),i=R("comment"),i.has("hidden")||i.set("hidden",[]),i.has("show")||i.set("show",[])},send:async o=>{let n=o.getAttribute("data-uuid"),e=document.getElementById("form-name"),t=e.value;if(t.length===0){r.notify("Name cannot be empty.").warning(),n&&e.scrollIntoView({block:"center"});return}let l=document.getElementById("form-presence");if(!n&&l&&l.value==="0"){r.notify("Please select your attendance status.").warning();return}let v=_.isOpen(n||_.default),k=_.getResultId(n||_.default),S=_.buttonCancel(n);if(v&&!k){r.notify("Gif cannot be empty.").warning();return}v&&k&&S.hide();let B=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!v&&B.value?.trim().length===0){r.notify("Comments cannot be empty.").warning();return}!n&&e&&!C.isAdmin()&&(e.disabled=!0),!C.isAdmin()&&l&&l.value!=="0"&&(l.disabled=!0),B&&(B.disabled=!0);let O=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);O&&(O.disabled=!0);let J=r.disableButton(o),d=l?l.value==="1":!0;if(!C.isAdmin()){let E=R("information");E.set("name",t),n||E.set("presence",d)}let c=await P(K,`/api/comment?lang=${V.getLanguage()}`).token(C.getToken()).body(q.postCommentRequest(n,t,d,v?null:B.value,k)).send(q.getCommentResponse);if(e&&(e.disabled=!1),B&&(B.disabled=!1),O&&(O.disabled=!1),l&&(l.disabled=!1),v&&k&&S.show(),J.restore(),!(!c||c.code!==201)){if(s.set(c.data.uuid,c.data.own),B&&(B.value=null),v&&k&&S.click(),!n){if(j.reset()){await w(),f.scrollIntoView();return}j.setTotal(j.geTotal()+1),f.children.length===j.getPer()&&f.lastElementChild.remove(),c.data.is_parent=!0,c.data.is_admin=C.isAdmin(),f.insertAdjacentHTML("afterbegin",await F.renderContentMany([c.data])),f.scrollIntoView()}if(n){i.set("hidden",i.get("hidden").concat([q.commentShowMore(c.data.uuid,!0)])),i.set("show",i.get("show").concat([n])),y(n),c.data.is_parent=!1,c.data.is_admin=C.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await F.renderContentSingle(c.data));let E=document.getElementById(`button-${n}`).querySelector("a");E&&(E.getAttribute("data-show")==="false"&&h(E),E.remove());let H=[c.data.uuid],D=document.createRange().createContextualFragment(F.renderReadMore(n,E?E.getAttribute("data-uuids").split(",").concat(H):H)),N=W.getButtonLike(n);N.parentNode.insertBefore(D,N)}W.addListener(c.data.uuid),u.push(c.data.uuid)}},edit:async(o,n)=>{let e=o.getAttribute("data-uuid");T(e,!0),C.isAdmin()&&s.set(e,o.getAttribute("data-own"));let t=document.getElementById(`badge-${e}`),l=!!t&&t.getAttribute("data-is-presence")==="true",v=document.getElementById(`img-gif-${e}`);v&&await _.remove(e);let k=n&&!C.isAdmin();if(document.getElementById(`button-${e}`).insertAdjacentElement("afterend",F.renderEdit(e,l,k,!!v)),v){_.onOpen(e,()=>{_.removeGifSearch(e),_.removeButtonBack(e)}),await _.open(e);return}let S=document.getElementById(`form-inner-${e}`),B=r.base64Decode(document.getElementById(`content-${e}`)?.getAttribute("data-comment"));S.value=B,S.setAttribute("data-original",r.base64Encode(B))},reply:o=>{T(o,!0),_.remove(o).then(()=>{_.onOpen(o,()=>_.removeGifSearch(o)),document.getElementById(`button-${o}`).insertAdjacentElement("afterend",F.renderReply(o))})},remove:async o=>{if(!r.ask("Are you sure?"))return;let n=o.getAttribute("data-uuid");C.isAdmin()&&s.set(n,o.getAttribute("data-own")),T(n,!0);let e=r.disableButton(o),t=W.getButtonLike(n);if(t.disabled=!0,!await P(ue,"/api/comment/"+s.get(n)).token(C.getToken()).send(q.statusResponse).then(v=>v.data.status)){e.restore(),t.disabled=!1,T(n,!1);return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(v=>{let k=v.getAttribute("data-uuids").split(",");if(k.includes(n)){let S=k.filter(B=>B!==n).join(",");S.length===0?v.remove():v.setAttribute("data-uuids",S)}}),s.unset(n),document.getElementById(n).remove(),f.children.length===0&&(f.innerHTML="")},update:async o=>{let n=o.getAttribute("data-uuid"),e=!1,t=document.getElementById(`form-inner-presence-${n}`);t&&(t.disabled=!0,e=t.value==="1");let l=document.getElementById(`badge-${n}`),v=!!l&&l.getAttribute("data-is-presence")==="true",k=_.isOpen(n),S=_.getResultId(n),B=_.buttonCancel(n);k&&S&&B.hide();let O=document.getElementById(`form-inner-${n}`);if(n&&!k&&r.base64Encode(O.value)===O.getAttribute("data-original")&&v===e){y(n);return}if(!k&&O.value?.trim().length===0){r.notify("Comments cannot be empty.").warning();return}O&&(O.disabled=!0);let J=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);J&&(J.disabled=!0);let d=r.disableButton(o),c=await P("PUT",`/api/comment/${s.get(n)}?lang=${V.getLanguage()}`).token(C.getToken()).body(q.updateCommentRequest(t?e:null,k?null:O.value,S)).send(q.statusResponse).then(E=>E.data.status);if(O&&(O.disabled=!1),J&&(J.disabled=!1),t&&(t.disabled=!1),d.restore(),k&&S&&B.show(),!!c){if(k&&S&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,B.click()),y(n),!k){let E=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),H=document.getElementById(`content-${n}`);H.setAttribute("data-comment",r.base64Encode(O.value));let D=r.convertMarkdownToHTML(r.escapeHtml(O.value));O.value.length>F.maxCommentLength?(r.safeInnerHTML(H,E?.getAttribute("data-show")==="false"?D.slice(0,F.maxCommentLength)+"...":D),E?.classList.replace("d-none","d-block")):(r.safeInnerHTML(H,D),E?.classList.replace("d-block","d-none"))}t&&(document.getElementById("form-presence").value=e?"1":"2",R("information").set("presence",e)),!(!t||!l)&&(l.classList.toggle("fa-circle-xmark",!e),l.classList.toggle("text-danger",!e),l.classList.toggle("fa-circle-check",e),l.classList.toggle("text-success",e))}},cancel:async(o,n)=>{let e=document.getElementById(`form-inner-presence-${n}`),t=e?e.value==="1":!1,l=document.getElementById(`badge-${n}`),v=l&&s.has(n)&&e?l.getAttribute("data-is-presence")==="true":!1,k=r.disableButton(o);if(_.isOpen(n)&&(!_.getResultId(n)&&v===t||r.ask("Are you sure?"))){await _.remove(n),y(n);return}let S=document.getElementById(`form-inner-${n}`);if(S.value.length===0||r.base64Encode(S.value)===S.getAttribute("data-original")&&v===t||r.ask("Are you sure?")){y(n);return}k.restore()},show:w,showMore:$,showOrHide:h}})();var he=(()=>{let s=()=>Z.getDetailUser().then(p=>{r.safeInnerHTML(document.getElementById("dashboard-name"),`${r.escapeHtml(p.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=p.data.email,document.getElementById("dashboard-accesskey").value=p.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",p.data.access_key),document.getElementById("form-name").value=r.escapeHtml(p.data.name),document.getElementById("form-timezone").value=p.data.tz,document.getElementById("filterBadWord").checked=!!p.data.is_filter,document.getElementById("confettiAnimation").checked=!!p.data.is_confetti_animation,document.getElementById("replyComment").checked=!!p.data.can_reply,document.getElementById("editComment").checked=!!p.data.can_edit,document.getElementById("deleteComment").checked=!!p.data.can_delete,document.getElementById("dashboard-tenorkey").value=p.data.tenor_key,R("config").set("tenor_key",p.data.tenor_key),document.dispatchEvent(new Event("undangan.session")),P("GET","/api/stats").token(C.getToken()).withCache(3e4).withForceCache().send().then(a=>{document.getElementById("count-comment").textContent=String(a.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(a.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(a.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(a.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),ae.show()}),i=(p,a)=>{let m=r.disableCheckbox(p);P(G,"/api/user").token(C.getToken()).body({[a]:p.checked}).send().finally(()=>m.restore())},f=p=>{let a=r.disableButton(p),m=document.getElementById("dashboard-tenorkey");m.disabled=!0,P(G,"/api/user").token(C.getToken()).body({tenor_key:m.value.length?m.value:null}).send().then(()=>r.notify(`success ${m.value.length?"add":"remove"} tenor key`).success()).finally(()=>{m.disabled=!1,a.restore()})},u=p=>{if(!r.ask("Are you sure?"))return;let a=r.disableButton(p);P("PUT","/api/key").token(C.getToken()).send(q.statusResponse).then(m=>{m.data.status&&s()}).finally(()=>a.restore())},T=p=>{let a=document.getElementById("old_password"),m=document.getElementById("new_password");if(a.value.length===0||m.value.length===0){r.notify("Password cannot be empty").warning();return}a.disabled=!0,m.disabled=!0;let L=r.disableButton(p);P(G,"/api/user").token(C.getToken()).body({old_password:a.value,new_password:m.value}).send(q.statusResponse).then(o=>{o.data.status&&(a.value=null,m.value=null,r.notify("Success change password").success())}).finally(()=>{L.restore(!0),a.disabled=!1,m.disabled=!1})},y=p=>{let a=document.getElementById("form-name");if(a.value.length===0){r.notify("Name cannot be empty").warning();return}a.disabled=!0;let m=r.disableButton(p);P(G,"/api/user").token(C.getToken()).body({name:a.value}).send(q.statusResponse).then(L=>{L.data.status&&(r.safeInnerHTML(document.getElementById("dashboard-name"),`${r.escapeHtml(a.value)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),r.notify("Success change name").success())}).finally(()=>{a.disabled=!1,m.restore(!0)})},h=p=>{let a=r.disableButton(p);P("GET","/api/download").token(C.getToken()).withDownload("download","csv").send().finally(()=>a.restore())},$=()=>{let p=document.getElementById("button-change-name");p.disabled&&(p.disabled=!1)},b=()=>{let p=document.getElementById("button-change-password"),a=document.getElementById("old_password");p.disabled&&a.value.length!==0&&(p.disabled=!1)},I=(p,a=null)=>{let m=Intl.supportedValuesOf("timeZone"),L=document.getElementById("dropdown-tz-list");p.value&&p.value.trim().length>0&&(m=m.filter(o=>o.toLowerCase().includes(p.value.trim().toLowerCase()))),a===null&&document.addEventListener("click",o=>{if(!p.contains(o.currentTarget)&&!L.contains(o.currentTarget)){if(p.value.trim().length<=0){p.setCustomValidity("Timezone cannot be empty."),p.reportValidity();return}p.setCustomValidity(""),L.classList.add("d-none")}},{once:!0,capture:!0}),L.replaceChildren(),L.classList.remove("d-none"),m.slice(0,20).forEach(o=>{let n=document.createElement("button");n.type="button",n.className="list-group-item list-group-item-action py-1 small",n.textContent=`${o} (${r.getGMTOffset(o)})`,n.onclick=()=>{p.value=o,L.classList.add("d-none"),document.getElementById("button-timezone").disabled=!1},L.appendChild(n)})},w=p=>{let a=document.getElementById("form-timezone");if(a.value.length===0){r.notify("Time zone cannot be empty").warning();return}if(!Intl.supportedValuesOf("timeZone").includes(a.value)){r.notify("Timezone not supported").warning();return}a.disabled=!0;let m=r.disableButton(p);P(G,"/api/user").token(C.getToken()).body({tz:a.value}).send(q.statusResponse).then(L=>{L.data.status&&r.notify("Success change tz").success()}).finally(()=>{a.disabled=!1,m.restore(!0)})},g=()=>{r.ask("Are you sure?")&&Z.clearSession()},x=()=>{V.init(),V.setDefault("en"),ae.init(),fe.init(),se.spyTop(),document.addEventListener("hidden.bs.modal",s);let p=window.location.hash.slice(1);p.length>0&&(C.setToken(p),window.history.replaceState({},document.title,window.location.pathname)),C.isValid()?s():Z.clearSession()};return{init:()=>(Z.init(),se.init(),C.init(),C.isAdmin()||(R("owns").clear(),R("likes").clear(),R("config").clear(),R("comment").clear(),R("session").clear(),R("information").clear()),window.addEventListener("load",()=>Y.init(x,["gif"])),{util:r,theme:se,comment:ae,admin:{auth:Z,navbar:me,logout:g,tenor:f,download:h,regenerate:u,changeName:y,changePassword:T,changeCheckboxValue:i,enableButtonName:$,enableButtonPassword:b,openLists:I,changeTz:w}})}})();(s=>{s.undangan=he.init()})(window);})();
